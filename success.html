<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Download Fyenance - Thank You for Your Purchase</title>
    <meta name="description" content="Thank you for purchasing Fyenance! Download your copy of our privacy-focused personal finance app and start managing your money better today.">
    <meta name="robots" content="noindex">  <!-- Don't index success page -->
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://fyenanceapp.com/success.html">
    <meta property="og:title" content="Download Fyenance - Thank You for Your Purchase">
    <meta property="og:description" content="Thank you for purchasing Fyenance! Download your copy of our privacy-focused personal finance app and start managing your money better today.">
    <meta property="og:image" content="https://fyenanceapp.com/assets/images/og-image.png">

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://fyenanceapp.com/success.html">
    <meta name="twitter:title" content="Download Fyenance - Thank You for Your Purchase">
    <meta name="twitter:description" content="Thank you for purchasing Fyenance! Download your copy of our privacy-focused personal finance app and start managing your money better today.">
    <meta name="twitter:image" content="https://fyenanceapp.com/assets/images/og-image.png">

    <!-- No canonical on success page -->

    <!-- Favicons -->
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/images/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/images/favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/images/apple-touch-icon.png">

    <!-- Existing style imports -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter+Tight:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/cookie-consent.css">


    <script>
        async function fetchLatestRelease() {
            try {
                const response = await fetch('https://api.github.com/repos/ltalebli99/Fyenance/releases/latest');
                const release = await response.json();
                
                // Find assets for each platform
                const assets = release.assets;
                let windowsAsset = assets.find(asset => asset.name.endsWith('.exe'));
                let macIntelAsset = assets.find(asset => asset.name.includes('x64') && asset.name.endsWith('.dmg'));
                let macSiliconAsset = assets.find(asset => asset.name.includes('arm64') && asset.name.endsWith('.dmg'));
                let linuxAsset = assets.find(asset => asset.name.endsWith('.AppImage'));

                // Helper function to format file size
                const formatSize = (bytes) => {
                    if (bytes === 0) return '0 B';
                    const k = 1024;
                    const sizes = ['B', 'KB', 'MB', 'GB'];
                    const i = Math.floor(Math.log(bytes) / Math.log(k));
                    return `${parseFloat((bytes / Math.pow(k, i)).toFixed(1))} ${sizes[i]}`;
                };

                // Update download buttons
                if (windowsAsset) {
                    const btn = document.getElementById('windows-download');
                    btn.href = windowsAsset.browser_download_url;
                    btn.classList.remove('disabled');
                    btn.querySelector('.download-info').textContent = 
                        `v${release.tag_name.replace('v', '')} • ${formatSize(windowsAsset.size)}`;
                }
                
                if (macIntelAsset) {
                    const btn = document.getElementById('mac-intel-download');
                    btn.href = macIntelAsset.browser_download_url;
                    btn.classList.remove('disabled');
                    btn.querySelector('.download-info').textContent = 
                        `v${release.tag_name.replace('v', '')} • ${formatSize(macIntelAsset.size)}`;
                }
                
                if (macSiliconAsset) {
                    const btn = document.getElementById('mac-silicon-download');
                    btn.href = macSiliconAsset.browser_download_url;
                    btn.classList.remove('disabled');
                    btn.querySelector('.download-info').textContent = 
                        `v${release.tag_name.replace('v', '')} • ${formatSize(macSiliconAsset.size)}`;
                }
                
                if (linuxAsset) {
                    const btn = document.getElementById('linux-download');
                    btn.href = linuxAsset.browser_download_url;
                    btn.classList.remove('disabled');
                    btn.querySelector('.download-info').textContent = 
                        `v${release.tag_name.replace('v', '')} • ${formatSize(linuxAsset.size)}`;
                }

            } catch (error) {
                console.error('Error fetching release:', error);
                document.querySelectorAll('.download-info').forEach(info => {
                    info.textContent = 'Download unavailable';
                });
            }
        }

        // Call when page loads
        document.addEventListener('DOMContentLoaded', fetchLatestRelease);
    </script>
</head>
<body>
    <noscript><img height="1" width="1" style="display:none"
        src="https://www.facebook.com/tr?id=8909592305800884&ev=PageView&noscript=1"
    /></noscript>
    <header>
        <nav>
            <a href="https://www.fyenanceapp.com" class="logo">
                <img src="assets/images/favicon-96x96.png" alt="Fyenance Logo" class="logo-icon">
                <h1>Fyenance</h1>
            </a>
        </nav>
    </header>

    <main>
        <section class="pricing" style="padding-top: 2rem;">
            <div class="success-card">
                <div class="success-content">
                    <div class="success-icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <h2>Payment Successful!</h2>
                    <p class="subtitle">Thank you for purchasing Fyenance</p>
                    
                    <div class="success-details">
                        <div class="success-step">
                            <i class="fas fa-envelope"></i>
                            <div>
                                <h3>Check Your Email</h3>
                                <p>Your license key has been sent to your email address</p>
                            </div>
                        </div>
                        <div class="success-step">
                            <i class="fas fa-download"></i>
                            <div>
                                <h3>Download Fyenance</h3>
                                <div class="download-options" style="margin-top: 1rem;">
                                    <a id="windows-download" href="#" class="download-button disabled">
                                        <div class="download-content">
                                            <i class="fab fa-windows"></i>
                                            <span class="platform-name">Windows</span>
                                        </div>
                                        <span class="download-info">Loading...</span>
                                    </a>
                                    <a id="mac-intel-download" href="#" class="download-button disabled">
                                        <div class="download-content">
                                            <i class="fab fa-apple"></i>
                                            <span class="platform-name">macOS (Intel)</span>
                                        </div>
                                        <span class="download-info">Loading...</span>
                                    </a>
                                    <a id="mac-silicon-download" href="#" class="download-button disabled">
                                        <div class="download-content">
                                            <i class="fab fa-apple"></i>
                                            <span class="platform-name">macOS (Apple Silicon)</span>
                                        </div>
                                        <span class="download-info">Loading...</span>
                                    </a>
                                    <a id="linux-download" href="#" class="download-button disabled">
                                        <div class="download-content">
                                            <i class="fab fa-linux"></i>
                                            <span class="platform-name">Linux</span>
                                        </div>
                                        <span class="download-info">Loading...</span>
                                    </a>
                                </div>
                                <div style="text-align: center; margin-top: 6rem;">
                                    <a href="/help.html" class="help-link" style="color: #2E7D32; text-decoration: none; font-size: 0.9rem; display: flex; gap: 0.5rem; align-items: center; justify-content: center;">
                                        <i class="fas fa-question-circle"></i>
                                        Having trouble installing?
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <div class="footer-content">
            <div class="footer-brand">
                <img src="assets/images/favicon-32x32.png" alt="Fyenance Logo" class="footer-logo">
                <p>© 2025 Fyenance</p>
            </div>
            <div class="footer-links">
                <a href="help.html">Help</a>
                <a href="community.html">Community</a>
                <a href="mailto:info@fyenanceapp.com">Contact</a>
                <a href="privacy.html">Privacy Policy</a>
                <a href="terms.html">Terms of Service</a>
            </div>
        </div>
    </footer>

    
    <script>
        // Function to get URL parameters
        function getUrlParameter(name) {
            name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
            var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
            var results = regex.exec(location.search);
            return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
        }
    
        // Track successful purchase
        async function trackPurchase() {
            const sessionId = getUrlParameter('session_id');
            const email = getUrlParameter('email');
            
            if (!sessionId) {
                console.log('No session ID found, skipping tracking');
                return;
            }
            if (!email) {
                console.log('No email found, skipping tracking');
                return;
            }

            // Track in Google Analytics (will only work if cookies are accepted)
            if (typeof gtag === 'function') {
                console.log('Calling gtag events');
                gtag('event', 'purchase', {
                    transaction_id: sessionId,
                    value: 12.00,
                    currency: 'USD',
                    session_id: window.fyenanceSessionId,
                    email: email,
                    items: [{
                        item_name: 'Fyenance License',
                        item_category: 'Software License',
                        price: 12.00,
                        quantity: 1
                    }]
                });
                gtag('event', 'conversion', {
                    'send_to': 'AW-16822557696/I6Q1CNe8t6YaEIC4z9U-',
                    'transaction_id': '',
                })
            }

            // Track in Reddit Pixel
            if (typeof trackRedditPurchase === 'function') {
                console.log('Calling trackRedditPurchase');
                trackRedditPurchase(email, sessionId);
            }

            // Track in Meta Pixel
            if (typeof trackMetaPurchase === 'function') {
                console.log('Calling trackMetaPurchase');
                trackMetaPurchase(email, sessionId);
            }
        }
    
        // Run when page loads
        document.addEventListener('DOMContentLoaded', () => {
            trackPurchase();
        });
    </script>

    <!-- Only include cookie consent script -->
    <script src="js/cookie-consent.js"></script>
</body>
</html>